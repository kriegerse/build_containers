---
# build-clamv:
#   stage: build
#   script:
#     - source build_info.sh
#     - docker build --network host -f clamav/Dockerfile
#       --build-arg FS_BASE=clamav
#       -t $docker_username/clamav-stage:$BUILD_PRIMARY_TAG .
#     - docker push $docker_username/clamav-stage:$BUILD_PRIMARY_TAG
#     - docker image ls
#     - for i in $BUILD_SECONDARY_TAGS ; do
#         docker tag $docker_username/clamav-stage:$BUILD_PRIMARY_TAG
#         $docker_username/clamav-stage:$i ;
#         docker push $docker_username/clamav-stage:$i ; done
#   only:
#     changes:
#       - clamav/*

test-clamav:
  stage: test
  services:
    # - docker:dind
    - name: kriegerse/clamav-stage:commit-6dad18c5
      alias: clamav
  image: kriegerse/clamav-stage:commit-6dad18c5
  variables:
    BUILD_PRIMARY_TAG: commit-6dad18c5
  before_script: []
  script:
    # - source build_info.sh
    - apk add bash clamav
    - bash clamav/tests/clamd_eicar.sh
  only:
    changes:
      - clamav/*
      - clamav/**/*


# test-clamav:
#  stage: test
# publish-clamav:
#   stage: publish
#   script:
#     - docker pull
#     - docker image ls
#     - docker image ls $docker_username/clamav-stage:gitlabtest
