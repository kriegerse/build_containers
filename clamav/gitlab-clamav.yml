---
build-clamv:
  stage: build
  script:
    - source build_info.sh
    - docker build --network host -f clamav/Dockerfile
      --build-arg FS_BASE=clamav
      -t $docker_username/clamav-stage:$BUILD_PRIMARY_TAG .
    - docker push $docker_username/clamav-stage:$BUILD_PRIMARY_TAG
    - for i in $BUILD_SECONDARY_TAGS ; do
        docker tag $docker_username/clamav-stage:$BUILD_PRIMARY_TAG \
        $docker_username/clamav-stage:$i ;
      done
  only:
    changes:
      - clamav/*

test-clamav:
  stage: test
  services:
    - docker:dind
    - kriegerse/clamav-stage:$CI_COMMIT_SHORT_SHA
  script:
    - source build_info.sh
    - env
    - docker ps -a
  only:
    changes:
      - clamav/*



# test-clamav:
#  stage: test

# publish-clamav:
#   stage: publish
#   script:
#     - docker pull
#     - docker image ls
#     - docker image ls $docker_username/clamav-stage:gitlabtest
